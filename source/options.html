<!DOCTYPE html>
<html>

<head>

<meta http-equiv="Content-Type" content="text/html;charset=utf-8">

<script src="options_file/options_desc.js"></script>
<script src="options_file/input_type.js"></script>
<script src="translation.js"></script>
<script src="strings.js"></script>
<link rel="stylesheet" type="text/css" href="options_file/layout.css">
<link rel="stylesheet" type="text/css" href="lang_layout.css">

</head>

<body>
<div id="cont"></div>

<script>

function set_def_value(id) {
	input = document.getElementById("opt_"+id+"_input");
	input.set_value(options_desc[id].def_value);
}

function add_option(id) {

	input = create_input_element(id);
	
	desc = document.createElement("span");
	desc.className = "desc";
	
	desc_string = _(options_desc[id].title);
	if (_(options_desc[id].desc) != "") desc_string += " - <span class=\"long_desc\">" + _(options_desc[id].desc) + "</span>";
	desc.innerHTML = desc_string;
	
	
	def_value = document.createElement("span");
	def_value.className = "def_value";
	def_value.innerHTML = "<a style=\"text-decoration:none\" href='javascript:set_def_value(\""+id+"\")'>["+_("default value")+"]</a>";
	
	option_container = document.createElement("div");
	option_container.setAttribute("id", "opt_"+id);
	option_container.appendChild(input);
	option_container.appendChild(desc);
	option_container.appendChild(def_value);

	document.getElementById("cont").appendChild(option_container);

}

function insert_section_title(title) {

	section = document.createElement("div");
	section.className = "section_title";
	section.innerHTML = _(title);
	
	document.getElementById("cont").appendChild(section);

}

function apply_deps(name) {
	document.getElementById("opt_"+name+"_input").apply_deps();
}


function import_list() {

	ielist = document.getElementById("ielist");
	new_list = ielist.value;

	//remove multiple space
	new_list = new_list.replace(/[ ]+/g, " ");

	//check first char = space and last char != space
	new_list = " " + new_list + " ";
	new_list = new_list.replace(/^[ ]+/g, " ");
	new_list = new_list.replace(/[ ]+$/g, " ");

	localStorage.setItem("site_list", new_list);
	ielist.value = new_list;

	opera.extension.bgProcess.load_list();

	alert(_("New list imported"));
}

function load() {

	document.title = _("Scroll Marker options page");
	
	document.getElementById("cont").innerHTML += "<p class=\"header\">Scroll Marker <span style=\"font-size:13px\">"+_("version")+" 0.5-4</span><br><a href=\"http://stylecode.altervista.org\" style=\"font-size:15px\">"+_("by Damage92")+"</a></p>";

	insert_section_title("Marker aspect:");
	add_option("trasp");
	add_option("color");
	add_option("height");
	add_option("line_type");

	insert_section_title("Thumbnail:");
	add_thumbnail();

	insert_section_title("Behavior:");
	add_option("time_ch");
	add_option("time");	
		apply_deps("time_ch");	
	add_option("hide_click");
	add_option("mode");

	insert_section_title("Popup and list:");
	add_option("button");
	add_option("black");

	add_activation_buttons();

	update_thumb("trasp");
	update_thumb("color");
	update_thumb("height");
	update_thumb("line_type");

	export_list = document.createElement("div");
	export_list.id = "export_list";
	export_list.innerHTML = _("- To export the list you can copy it from this text input in a text file.") + "<br>" + _("- To import the list clear the text input, paste the list into it and click on \"import\". This action will delete old list.") + "<br>" + _("- Attention: if the imported list isn't well formed, the extension may stop works!"); + "<br>";	

	export_input = document.createElement("input");
	export_input.type = "text";
	export_input.id = "ielist";
	export_input.style = "width:620px";
	export_input.value = localStorage.getItem("site_list");	
	
	export_button = document.createElement("input");
	export_button.type = "button";
	export_button.value = _("import");
	export_button.style = "float:right";
	export_button.onclick = import_list;
	
	document.getElementById("cont").appendChild(export_list);
	document.getElementById("cont").appendChild(export_input);
	document.getElementById("cont").appendChild(export_button);
	
	
}

function change_activation(event) {

	if (event.target == undefined) new_status = event;
	else new_status = event.target.id;

	document.getElementById("active_bt").className = "";
	document.getElementById("list_bt").className = "";
	document.getElementById("deactive_bt").className = "";
	event.target.className = "bt_selected";

	switch(new_status) {
	
	case "active", "active_bt":
		opera.extension.bgProcess.activate();
	break;
	
	case "list", "list_bt":
		opera.extension.bgProcess.activate_list();
	break;

	case "deactive", "deactive_bt":
		opera.extension.bgProcess.deactivate();
	break;
	
	}

}

function add_activation_buttons() {

	active_bt = document.createElement("button");
	active_bt.id = "active_bt";
	active_bt.addEventListener("click", change_activation, false);
	active_bt.innerHTML = _("Always active");

	list_bt = document.createElement("button");
	list_bt.id = "list_bt";
	list_bt.addEventListener("click", change_activation, false);	
	list_bt.innerHTML = _("According to the list");

	deactive_bt = document.createElement("button");
	deactive_bt.id = "deactive_bt";
	deactive_bt.addEventListener("click", change_activation, false);	
	deactive_bt.innerHTML = _("Deactive");

	switch(widget.preferences.active) {
	case "true":
		active_bt.className = "bt_selected";
	break;

	case "list":
		list_bt.className = "bt_selected";
	break;

	case "false":
		deactive_bt.className = "bt_selected";
	break;
	
	}

	bts_cont = document.createElement("div");
	bts_cont.id = "bts_cont";
	
	bts_cont.appendChild(active_bt);
	bts_cont.appendChild(list_bt);
	bts_cont.appendChild(deactive_bt);

	bts_cont.style.textAlign = "center";

	document.getElementById("cont").appendChild(bts_cont);
}

function add_thumbnail() {

	cont = document.createElement("div");
	cont.id = "thumb_cont";
	thumb = document.createElement("div");
	thumb.id = "thumb";	
		
	thumb.arr_sx = document.createElement('img');
	thumb.arr_sx.style = "float:left; margin-left:5px; padding:0px; height:14px; position:relative";
	thumb.arr_sx.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAOCAYAAAD0f5bSAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHEQg4DYmVO1gAAACKSURBVCjPlZJBDsMgDATHUfoq+1vwiPAt86oeyKGlsihtyEq+oJ1dS0ZUNfFSAai1cqUNON7TgNRaYzZRoqptEpbdvYyPIvIXmsId2i7WP8zsE9rX3FiQmTUzSx1cgkJrWm4atd/wyh0oA8Xdl5sEIAIi8hP6So932mfmMT0CHcrxwwIPd3/OzF0nu6o/8Ob0XsUAAAAASUVORK5CYII=";
	
	thumb.arr_dx = document.createElement('img');
	thumb.arr_dx.style = "float:right; margin-right:5px; padding:0px; height:14px; position:relative;";
	thumb.arr_dx.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAOCAYAAAD0f5bSAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHEQg4G31BjgkAAABoSURBVCjPlZJLCsAwCAXHfk7lrQrpIXovT9VFukkhEEz07QQno0EhEFXdgQ0oQD2I5QKev5CFofTNU8hrdiFVratZJfr6AGUA2jemI9l9BpOZCXCnTFGru9PMKsHbK+EzasBpZm8H8wFkchttrR+4nAAAAABJRU5ErkJggg==";	

	thumb.line = document.createElement('div');
	thumb.line.style = "padding:0px; background-repeat: repeat-x; width:640px; margin-left:20px";

	thumb.appendChild(thumb.arr_sx);
	thumb.appendChild(thumb.arr_dx);
	thumb.appendChild(thumb.line);
		
	cont.appendChild(thumb);
	document.getElementById("cont").appendChild(cont);
	

}

function update_thumb(property) {

	thumb = document.getElementById("thumb");
	if (thumb == undefined) return;
	
	switch (property) {
	
	case "trasp":
		thumb.style.opacity = (100-widget.preferences.trasp)/100;	
	break;

	case "color":
		thumb.style.background = widget.preferences.color;
	break;

	case "height":
		thumb.style.height = widget.preferences.height + "px";	
		thumb.arr_sx.style.top = (widget.preferences.height-14)/2 + "px";
		thumb.arr_dx.style.top = (widget.preferences.height-14)/2 + "px";
		thumb.line.style.backgroundPosition = "0px " + widget.preferences.height/2 + "px";
		thumb.line.style.height = widget.preferences.height + "px";
	break;


	case "line_type":	
		thumb.line.style.display = "block";

		if (widget.preferences.line_type == "0") thumb.line.style.backgroundImage = "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHFAkwI6uGJpoAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAFUlEQVQI12NgQICHDAwM/9HwfZgkAG0xBb1uGg3+AAAAAElFTkSuQmCC)";

		if (widget.preferences.line_type == "1") thumb.line.style.backgroundImage = "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHFAktBh/unsEAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAADUlEQVQI12NgYGD4DwABBAEApOCsMQAAAABJRU5ErkJggg==)";

		if (widget.preferences.line_type == "2") thumb.line.style.display = "none";	
	break;	
	

	}
	
}

document.addEventListener("DOMContentLoaded", load, false);

</script>

<body>
</html>
